<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ¶rev Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
</head>
<body>
    <h1>GÃ¶rev Debug SayfasÄ±</h1>
    <div id="results"></div>
    
    <script>
        async function debugTasks() {
            try {
                console.log('ğŸ” GÃ¶rev debug baÅŸlatÄ±lÄ±yor...');
                
                // 1. Supabase baÄŸlantÄ±sÄ±nÄ± kontrol et
                console.log('1. Supabase baÄŸlantÄ±sÄ± kontrol ediliyor...');
                console.log('Supabase URL:', supabase.supabaseUrl);
                console.log('Supabase Key:', supabase.supabaseKey.substring(0, 20) + '...');
                
                // 2. TÃ¼m gÃ¶revleri al
                console.log('2. TÃ¼m gÃ¶revler alÄ±nÄ±yor...');
                const { data: allTasks, error: allTasksError } = await supabase
                    .from('tasks')
                    .select('*')
                    .eq('is_active', true);
                
                if (allTasksError) {
                    console.error('âŒ TÃ¼m gÃ¶revler alÄ±namadÄ±:', allTasksError);
                    document.getElementById('results').innerHTML = '<p style="color: red;">âŒ TÃ¼m gÃ¶revler alÄ±namadÄ±: ' + allTasksError.message + '</p>';
                    return;
                }
                
                console.log('âœ… TÃ¼m gÃ¶revler:', allTasks);
                
                // 3. MaÄŸaza atamalarÄ±nÄ± kontrol et
                console.log('3. MaÄŸaza atamalarÄ± kontrol ediliyor...');
                const { data: assignments, error: assignmentsError } = await supabase
                    .from('task_assignments')
                    .select('*');
                
                if (assignmentsError) {
                    console.error('âŒ Atamalar alÄ±namadÄ±:', assignmentsError);
                } else {
                    console.log('âœ… Atamalar:', assignments);
                }
                
                // 4. Test maÄŸaza ID'si iÃ§in gÃ¶revleri kontrol et
                console.log('4. Test maÄŸaza ID (1) iÃ§in gÃ¶revler kontrol ediliyor...');
                const { data: testTasks, error: testTasksError } = await supabase
                    .from('tasks')
                    .select(`
                        *,
                        channels(name),
                        task_assignments(
                            id,
                            store_id,
                            photo_urls,
                            status,
                            stores(name)
                        )
                    `)
                    .eq('is_active', true)
                    .eq('task_assignments.store_id', 1);
                
                if (testTasksError) {
                    console.error('âŒ Test gÃ¶revleri alÄ±namadÄ±:', testTasksError);
                } else {
                    console.log('âœ… Test gÃ¶revleri:', testTasks);
                }
                
                // 5. SonuÃ§larÄ± gÃ¶ster
                let html = '<h2>Debug SonuÃ§larÄ±</h2>';
                
                html += '<h3>1. Supabase BaÄŸlantÄ±sÄ±</h3>';
                html += '<p>âœ… Supabase baÄŸlantÄ±sÄ± kuruldu</p>';
                
                html += '<h3>2. TÃ¼m GÃ¶revler</h3>';
                html += `<p><strong>Toplam gÃ¶rev sayÄ±sÄ±:</strong> ${allTasks.length}</p>`;
                if (allTasks.length > 0) {
                    html += '<ul>';
                    allTasks.forEach(task => {
                        html += `<li>ID: ${task.id}, BaÅŸlÄ±k: ${task.title}, Aktif: ${task.is_active}</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color: orange;">âš ï¸ HiÃ§ gÃ¶rev bulunamadÄ±!</p>';
                }
                
                html += '<h3>3. MaÄŸaza AtamalarÄ±</h3>';
                html += `<p><strong>Toplam atama sayÄ±sÄ±:</strong> ${assignments ? assignments.length : 0}</p>`;
                if (assignments && assignments.length > 0) {
                    html += '<ul>';
                    assignments.forEach(assignment => {
                        html += `<li>GÃ¶rev ID: ${assignment.task_id}, MaÄŸaza ID: ${assignment.store_id}, Durum: ${assignment.status}</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color: orange;">âš ï¸ HiÃ§ atama bulunamadÄ±!</p>';
                }
                
                html += '<h3>4. Test MaÄŸaza (ID: 1) GÃ¶revleri</h3>';
                html += `<p><strong>Test maÄŸaza gÃ¶rev sayÄ±sÄ±:</strong> ${testTasks ? testTasks.length : 0}</p>`;
                if (testTasks && testTasks.length > 0) {
                    html += '<ul>';
                    testTasks.forEach(task => {
                        html += `<li>ID: ${task.id}, BaÅŸlÄ±k: ${task.title}, Atama sayÄ±sÄ±: ${task.task_assignments ? task.task_assignments.length : 0}</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color: red;">âŒ Test maÄŸaza iÃ§in gÃ¶rev bulunamadÄ±!</p>';
                }
                
                // 6. Ã‡Ã¶zÃ¼m Ã¶nerileri
                html += '<h3>5. Ã‡Ã¶zÃ¼m Ã–nerileri</h3>';
                if (allTasks.length === 0) {
                    html += '<p style="color: red;">âŒ HiÃ§ gÃ¶rev yok! Admin panelinden gÃ¶rev oluÅŸturun.</p>';
                } else if (!assignments || assignments.length === 0) {
                    html += '<p style="color: red;">âŒ HiÃ§ atama yok! GÃ¶revler oluÅŸturulmuÅŸ ama maÄŸazalara atanmamÄ±ÅŸ.</p>';
                } else if (!testTasks || testTasks.length === 0) {
                    html += '<p style="color: red;">âŒ Test maÄŸaza (ID: 1) iÃ§in atama yok! FarklÄ± maÄŸaza ID\'si deneyin.</p>';
                    html += '<p><strong>Mevcut maÄŸaza ID\'leri:</strong></p>';
                    const storeIds = [...new Set(assignments.map(a => a.store_id))];
                    html += '<ul>';
                    storeIds.forEach(id => {
                        html += `<li>MaÄŸaza ID: ${id}</li>`;
                    });
                    html += '</ul>';
                }
                
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Debug hatasÄ±:', error);
                document.getElementById('results').innerHTML = '<p style="color: red;">âŒ Debug hatasÄ±: ' + error.message + '</p>';
            }
        }
        
        // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
        window.addEventListener('load', () => {
            setTimeout(debugTasks, 2000);
        });
    </script>
</body>
</html>

